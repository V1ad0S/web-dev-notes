# Хранение паролей

Представим, что на нашем сервисе зарегистрировался пользователь
с логином `hacker2009@gmail.com` и паролем `IHackedPentagon`.

Нам нужно сохранить эти данные, чтобы впоследствии пользователь смог аутентифицироваться
по этой связке.

Самый простой вариант - *сохранить в открытом виде* и при аутентификации проверять на соответствие.
Однако, если злоумышленник получит доступ к нашей базе данных, то он получит все логины и все пароли
всех пользователей нашего сервиса. С учётом того, что пользователи зачастую ставят одинаковые пароли
на разные сервисы, то потенциально мы компрометируем все аккаунты пользователя.
Следовательно, хранить такие данные в открытом виде не стоит.

Здесь можно использовать [хеширование](./02_hash-function.md). Логин, как правило, хранят в открытом виде,
а от пароля можно вычислить хеш и сохранить его. При аутентификации мы снова вычисляем хеш от введённого
пароля и сравниваем с хешем в базе данных. Теперь, если злоумышленник получает доступ к базе данных, то
вместо пароля в открытом виде он увидит длинную строку, из которой невозможно восстановить исходный пароль.

К сожалению, и у этой схемы есть недостатки. Пользователи часто используют простые пароли:
`123`, `password`, `hello`, `qwerty`. Для таких случаев хакеры используют подготовленные словари - таблицы
с предрассчитанными хешами по часто встречающимся паролям, и таким образом узнают исходный пароль.

Как с этим бороться? Можно брать хеш не просто от пароля, а от пароля с добавлением какой-то сложной строки,
которую знает только наш сервис. Такая строка называется "соль".

Для примера возьмем пароль: `password`

```
sha256(password) = 5e884898da28047151d0e56f8dc6292773603d0d6aabbdd62a11ef721d1542d8
```

Этот хеш присутствует, пожалуй, во всех словарях. Злоумышленник без труда восстановит исходный пароль.

"Подсолим" пароль: `password_LongSaltHere!%%%123`.
В данном случае солью будет добавочная строка `_LongSaltHere!%%%123`.

```
sha256(password_LongSaltHere!%%%123) = 879d02c7f0df26de6ccf4d25894547a0918eb51f557d93c3895431c2f762ddcc
```

Такого хеша в словарях совершенно точно нет. Соответсвенно восстановить исходный пароль по хешу будет
невозможно. А когда пользователь аутентифицируется, нет никакой проблемы добавить к введённому паролю
известную соль и взять хеш, чтобы сравнить с хешем в базе данных.

Соль может быть как *статической* (одинаковой для всех пользователей и зашитой в приложении),
так и *динамической* (вычисляемой по входным данным, например, 5 первых символов логина)
